AWSTemplateFormatVersion: 2010-09-09
Description: Main stack for VPC, S3, SageMaker, OpenSearch, IAM

Resources:
  VPCStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # was: file://vpc.yaml
      TemplateURL: vpc.yaml

  S3Stack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # was: file://s3.yaml
      TemplateURL: s3.yaml
      Parameters:
        BucketName: llm-bucket-0101040018

  IAMStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # NOTE: filename is case-sensitive on Linux
      # was: file://IAM.yaml
      TemplateURL: IAM.yaml
      Parameters:
        BucketName: llm-bucket-0101040018

  SageMakerStack:
    Type: AWS::CloudFormation::Stack
    DependsOn:
      - VPCStack
      - IAMStack
    Properties:
      # was: file://sagemaker-instance.yaml
      TemplateURL: sagemaker-instance.yaml
      Parameters:
        RoleArn: !GetAtt IAMStack.Outputs.RoleArn
        VpcId: !GetAtt VPCStack.Outputs.VpcId
        PrivateSubnetIds: !GetAtt VPCStack.Outputs.PrivateSubnetIds
        SecurityGroupId: !GetAtt VPCStack.Outputs.SecurityGroupId
        NotebookInstanceName: llm-notebook
        InstanceType: ml.t3.medium

  OpenSearchStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      # was: file://opensearch.yaml
      TemplateURL: opensearch.yaml
      Parameters:
        DomainName: llm-opensearch
